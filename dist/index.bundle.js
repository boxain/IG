(()=>{"use strict";var e={804:(e,o,r)=>{r.r(o),r.d(o,{default:()=>A});const n=require("joi");var s=r.n(n);r(142).config();const t=s().object().keys({NODE_ENV:s().string().default("development").valid("development","production"),PORT:s().number().default(8080),VERSION:s().string(),MYSQL_HOST:s().string().default("127.0.0.1"),MYSQL_PORT:s().number().default(3306),MYSQL_USER:s().string(),MYSQL_PASS:s().string(),MYSQL_DATABASE:s().string()}).unknown().required(),{error:c,value:i}=t.validate(process.env);if(c)throw new Error(`Config validation error: ${c.message}`);const l={NODE_ENV:i.NODE_ENV,VERSION:i.VERSION,PORT:i.PORT,MYSQL_HOST:i.MYSQL_HOST,MYSQL_PORT:i.MYSQL_PORT,MYSQL_USER:i.MYSQL_USER,MYSQL_PASS:i.MYSQL_PASS,MYSQL_DATABASE:i.MYSQL_DATABASE},a=require("express");var d=r.n(a);const S=require("mysql");var u=r.n(S);const g=u().createPool({connectionLimit:10,host:l.MYSQL_HOST,user:l.MYSQL_USER,password:l.MYSQL_PASS,database:l.MYSQL_DATABASE,port:l.MYSQL_PORT}),p=d().Router();p.route("/").get(((e,o)=>{new Promise(((e,o)=>{g.getConnection(((r,n)=>{r?(console.log("connection err",r),o(r)):n.query("SELECT * FROM igstory",((r,s)=>{r?(console.log("mysql err",r),o(r)):(console.log("sucess"),e(s)),n.release()}))}))})).then((e=>o.send(e))).catch((e=>{o.send(e)}))})).post(((e,o)=>{console.log(e.body);(e=>new Promise(((o,r)=>{g.getConnection(((n,s)=>{n?(console.log("connection err",n),r(n)):(e.map((e=>{s.query("INSERT INTO igstory set ?",e,((e,n)=>{e?(console.log("mysql err",e),r(e)):(console.log("sucess"),o(n))}))})),s.release())}))})))(e.body).then((e=>o.send(e))).catch((e=>{o.send(e)}))}));const _=p,m=u().createPool({connectionLimit:10,host:l.MYSQL_HOST,user:l.MYSQL_USER,password:l.MYSQL_PASS,database:l.MYSQL_DATABASE,port:l.MYSQL_PORT}),E=d().Router();E.route("/").get(((e,o)=>{new Promise(((e,o)=>{m.getConnection(((r,n)=>{r?(console.log("connection err",r),o(r)):n.query("SELECT * FROM igposts",((r,s)=>{r?(console.log("mysql err",r),o(r)):(console.log("sucess"),e(s)),n.release()}))}))})).then((e=>o.send(e))).catch((e=>{o.send(e)}))})).post(((e,o)=>{(e=>new Promise(((o,r)=>{m.getConnection(((n,s)=>{n?(console.log("connection err",n),r(n)):(e.map((n=>{s.query("INSERT INTO igposts SET?",e,((e,n)=>{e?(console.log("mysql err",e),r(e)):(console.log("sucess"),o(n))}))})),s.release())}))})))(e.body).then((e=>o.send(e))).catch((e=>{o.send(e)}))}));const M=E,O=d().Router();O.get("/",((e,o)=>{o.send("father fucker")})),O.use("/stories",_),O.use("/posts",M);const L=O,y=require("body-parser");var T=r.n(y);const v=require("cors");var P=r.n(v);const Q=require("morgan");var Y=r.n(Q);const R=require("path");var b=r.n(R);const f=d()();f.use(d().static(b().join(__dirname,"/public"))),f.use(T().json()),f.use(T().urlencoded({extended:!0})),f.use(P()()),f.use(Y()("dev")),f.get("/",((e,o)=>{o.status(200).sendFile(b().join(__dirname,"public/index.html"))})),f.use("/api",L);const h=f;(e=r.hmd(e)).parent||h.listen(l.PORT,(()=>{console.log(`env: ${l.NODE_ENV} and dir ${__dirname}`)}));const A=h},142:e=>{e.exports=require("dotenv")}},o={};function r(n){var s=o[n];if(void 0!==s)return s.exports;var t=o[n]={id:n,loaded:!1,exports:{}};return e[n](t,t.exports,r),t.loaded=!0,t.exports}r.n=e=>{var o=e&&e.__esModule?()=>e.default:()=>e;return r.d(o,{a:o}),o},r.d=(e,o)=>{for(var n in o)r.o(o,n)&&!r.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:o[n]})},r.hmd=e=>((e=Object.create(e)).children||(e.children=[]),Object.defineProperty(e,"exports",{enumerable:!0,set:()=>{throw new Error("ES Modules may not assign module.exports or exports.*, Use ESM export syntax, instead: "+e.id)}}),e),r.o=(e,o)=>Object.prototype.hasOwnProperty.call(e,o),r.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})};var n=r(804);module.exports=n})();